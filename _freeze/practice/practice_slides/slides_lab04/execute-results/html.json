{
  "hash": "ae710f755015acbede4483c0af23ed9e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lab 4:Mapping causal & predictive approaches\"\nsubtitle: \"<span style='font-size:2em;'> Practice session covering topics discussed in Lecture 4 </span>\"\nauthor: \"<a href='https://r4biostats.com/me.html' style='color:#72aed8;font-weight:600;'>M. Chiara Mimmi, Ph.D.</a>&ensp;|&ensp;Università degli Studi di Pavia\"\ndate: 2024-07-27\ndate-format: long\ncode-link: true\nformat:\n  revealjs:\n    smaller: true\n    scrollable: true\n    theme: ../../theme/slidesMine.scss # QUARTO LOOKS IN SAME FOLDER \n#    logo: imgs_slides/mitgest_logo.png\n    footer: '[R 4 Biostatistics](https://r4biostats.com/) | MITGEST::training(2024)'\n#    footer: <https://lulliter.github.io/R4biostats/lectures.html>\n## ------------- x salvare come PDF \n    standalone: false\n    ## -------Produce a standalone HTML file with no external dependencies,\n    embed-resources: true\n    transition: fade\n    background-transition: fade\n    highlight-style: ayu-mirage\n    slide-number: true\n    fig-cap-location: top\n    # fig-format: svg\n    pdf-separate-fragments: false\n    # fig-align: center\nexecute:\n  # Quarto pre code blocks do not echo their source code by default\n  echo: true\n  include: true\n  freeze: auto\nbibliography: ../../bib/R4biostats.bib\ncsl: ../../bib/apa-6th-edition.csl \nsuppress-bibliography: true\n---\n\n\n\n# [GOAL OF TODAY'S PRACTICE SESSION]{.r-fit-text}\n\n::: {style=\"font-size: 100%;\"}\n::: {style=\"color:#77501a\"}\n+ ...\n:::\n:::\n\n<br><br>\n\n::: {style=\"font-size: 70%;\"}\nThe examples and datasets in this Lab session follow very closely two sources:\n\n1. ...\n:::\n\n\n## Topics discussed in Lecture # 4\n\n\n::: {style=\"font-size: 95%;\"}\n**Lecture 4: topics** \n<!-- + Shifting the emphasis on **empirical prediction**  -->\n<!--   + Distinction between supervised & **unsupervised** algorithms -->\n<!--     + Unsupervised ML Example -->\n<!--       + PCA  -->\n\n+ ....\n\n<!-- + Workshop Conclusions -->\n\n:::  \n\n# R ENVIRONMENT SET UP & DATA\n\n## Needed R Packages\n::: {style=\"font-size: 85%;\"}\n\n+ We will use functions from packages `base`, `utils`, and `stats` (pre-installed and pre-loaded) \n+ We may also use the packages below (specifying `package::function` for clarity).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load pckgs for this R session\n\n# --- General \nlibrary(here)     # tools find your project's files, based on working directory\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nhere() starts at /Users/luisamimmi/Github/R4stats\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)    # A Grammar of Data Manipulation\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(skimr)    # Compact and Flexible Summaries of Data\nlibrary(magrittr) # A Forward-Pipe Operator for R \nlibrary(readr)    # A Forward-Pipe Operator for R \n\n# Plotting & data visualization\nlibrary(ggplot2)      # Create Elegant Data Visualisations Using the Grammar of Graphics\nlibrary(ggfortify)     # Data Visualization Tools for Statistical Analysis Results\n\n\nlibrary(dagitty)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'ggdag'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(patchwork)\nlibrary(broom)\nlibrary(data.table)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'data.table'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:dplyr':\n\n    between, first, last\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(simstudy)\nlibrary(gridExtra)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'gridExtra'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n\n\n:::\n\n```{.r .cell-code}\n#library(epiR)\n#library(tableone)\n#library(ipw)\nlibrary(sandwich) #for robust variance estimation\nlibrary(survey)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: grid\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: Matrix\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: survival\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'survey'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dagitty':\n\n    neighbours\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:graphics':\n\n    dotchart\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(haven)\n\n#library(EValue)\n```\n:::\n\n\n\n<!-- # Data  -->\n<!-- # devtools::install_github(\"OI-Biostat/oi_biostat_data\") -->\n<!-- #library(oibiostat) # Data Package for OpenIntro Biostatistics  -->\n:::\n\n# DATASETS for today\n\n<br>\n\n::: {style=\"font-size: 80%;\"}\nIn this tutorial, we will use: \n\n+ ....\n\n:::\n\n\n## [Dataset on ....]{.r-fit-text}\n\n::: {style=\"font-size: 95%;\"}\n**Name**: ....  \n**Documentation**: See reference on the data downloaded and ....\n**Sampling details**: This .... \n::: \n\n## [Importing Dataset `...`]{.r-fit-text}\n \n## [`....` variables with description]{.r-fit-text}\n\n::: {style=\"font-size: 80%;\"}\n<!-- [[EXCERPT: see complete file in Input Data Folder]]{style=\"color:#77501a\"} -->\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Variable </th>\n   <th style=\"text-align:left;\"> Type </th>\n   <th style=\"text-align:left;\"> Description </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> class </td>\n   <td style=\"text-align:left;\"> factor </td>\n   <td style=\"text-align:left;\"> benign or malignant </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n:::\n\nhttps://bookdown.org/jbrophy115/bookdown-clinepi/confounding.html\n\n## DAG to represent confounders\n\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\ndag <- dagitty::dagitty(\"dag {\n  X -> Y\n  Z -> X\n  Z -> Y\n  e -> Y\n               }\")\n\ndagitty::coordinates(dag ) <-  list(\n  x=c(X=1, Z=3, Y=5, e=5),\n  y=c(X=1, Z=3, Y=1, e=3))\n\nlibrary(ggdag)\ndag <-  tidy_dagitty(dag)\nex1 <-  ggdag(dag, layout = \"circle\") + \n  theme_dag_blank(plot.caption = element_text(hjust = 1)) + \n  geom_dag_node(color=\"pink\") + \n  geom_dag_text(color=\"white\") +\n  ggtitle(\"a) DAG with a confounder (Z)\") +\n  labs(caption = \"X = drug exposure\\nY = outcome\\nZ = confounder\\n e = random error\")\nex1\n```\n\n::: {.cell-output-display}\n![](slides_lab04_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n## ITE \n\nIndividual Treatment Effect (ITE) is defined as the difference in potential outcomes for a given individual \n$ITE_i= y_{i}^1  − y_{i}^0$\n\nThe Causal Effect (CE)\n \n$CE_i = Y_{1i} - Y_{0i}$ where $Y_{1i}$ and $Y_{0i}$ are the potential outcomes for each individual $i$ being *both* exposed and not exposed respectively (not possible in the real world).\n\nSimulation \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndef <- defData(varname = \"C\", formula = 0.4, dist = \"binary\")\ndef <- defData(def, \"X\", formula = \"0.3 + 0.4 * C\", dist = \"binary\")\ndef <- defData(def, \"e\", formula = 0, variance = 2, dist = \"normal\")\ndef <- defData(def, \"Y0\", formula = \"2 * C + e\", dist=\"nonrandom\")\ndef <- defData(def, \"Y1\", formula = \"1 + 2 * C + e\", dist=\"nonrandom\")\ndef <- defData(def, \"Y_obs\", formula = \"Y0 + (Y1 - Y0) * X\", dist = \"nonrandom\") #  = Y1*X + (1-X)*Y0\n\nset.seed(2017)\ndt <- genData(10000, def)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npaste0(\"Calculated mean causal effect = \", mean(dt[, Y1] - dt[, Y0])) #mean difference of counterfactual outcomes\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Calculated mean causal effect = 1\"\n```\n\n\n:::\n\n```{.r .cell-code}\npaste0(\"Calculated observed difference  = \", round(dt[X == 1, mean(Y_obs)] - dt[X == 0, mean(Y_obs)],2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Calculated observed difference  = 1.71\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlm1 <- lm(Y_obs ~ X, data = dt)\ntidy(lm1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)    0.481    0.0225      21.3 8.84e-99\n2 X              1.71     0.0335      51.1 0       \n```\n\n\n:::\n:::\n\n\n\n\n## Final thoughts\n\n::: {style=\"font-size: 95%;\"}\n::: {style=\"color:#77501a\"}\n\n\n+ .....\n\n:::\n\n:::\n\n",
    "supporting": [
      "slides_lab04_files/figure-html"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}